<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.8c4258acfb95297d0e4f.css">code[class*=language-],pre[class*=language-]{text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#90a4ae;background:#fafafa;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#cceae7;color:#263238}:not(pre)>code[class*=language-]{white-space:normal;border-radius:.2em;padding:.1em}pre[class*=language-]{overflow:auto;position:relative;margin:.5em 0;padding:1.25em 1em}.language-css>code,.language-sass>code,.language-scss>code{color:#f76d47}[class*=language-] .namespace{opacity:.7}.token.atrule{color:#7c4dff}.token.attr-name{color:#39adb5}.token.attr-value,.token.attribute{color:#f6a434}.token.boolean{color:#7c4dff}.token.builtin,.token.cdata,.token.char,.token.class{color:#39adb5}.token.class-name{color:#6182b8}.token.comment{color:#aabfc9}.token.constant{color:#7c4dff}.token.deleted{color:#e53935}.token.doctype{color:#aabfc9}.token.entity{color:#e53935}.token.function{color:#7c4dff}.token.hexcode{color:#f76d47}.token.id,.token.important{color:#7c4dff;font-weight:700}.token.inserted{color:#39adb5}.token.keyword{color:#7c4dff}.token.number{color:#f76d47}.token.operator{color:#39adb5}.token.prolog{color:#aabfc9}.token.property{color:#39adb5}.token.pseudo-class,.token.pseudo-element{color:#f6a434}.token.punctuation{color:#39adb5}.token.regex{color:#6182b8}.token.selector{color:#e53935}.token.string{color:#f6a434}.token.symbol{color:#7c4dff}.token.tag{color:#e53935}.token.unit{color:#f76d47}.token.url,.token.variable{color:#e53935}</style><meta name="generator" content="Gatsby 2.2.10"/><style type="text/css">
    .title-anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .title-anchor svg,
    h2 .title-anchor svg,
    h3 .title-anchor svg,
    h4 .title-anchor svg,
    h5 .title-anchor svg,
    h6 .title-anchor svg {
      visibility: hidden;
    }
    h1:hover .title-anchor svg,
    h2:hover .title-anchor svg,
    h3:hover .title-anchor svg,
    h4:hover .title-anchor svg,
    h5:hover .title-anchor svg,
    h6:hover .title-anchor svg,
    h1 .title-anchor:focus svg,
    h2 .title-anchor:focus svg,
    h3 .title-anchor:focus svg,
    h4 .title-anchor:focus svg,
    h5 .title-anchor:focus svg,
    h6 .title-anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><title data-react-helmet="true">Implementing the React.lazy() function by hand | Blog | Marvin Frachet</title><meta data-react-helmet="true" name="description" content="It’s been a time since the React’s team has introduced Suspense and concurrent rendering. With hooks, it’s the new amazing feature that React is providing. We…"/><meta data-react-helmet="true" property="og:title" content="Implementing the React.lazy() function by hand"/><meta data-react-helmet="true" property="og:description" content="It’s been a time since the React’s team has introduced Suspense and concurrent rendering. With hooks, it’s the new amazing feature that React is providing. We…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Marvin Frachet"/><meta data-react-helmet="true" name="twitter:title" content="Implementing the React.lazy() function by hand"/><meta data-react-helmet="true" name="twitter:description" content="It’s been a time since the React’s team has introduced Suspense and concurrent rendering. With hooks, it’s the new amazing feature that React is providing. We…"/><link as="script" rel="preload" href="/webpack-runtime-11d36ff36fb5c6e45fb5.js"/><link as="script" rel="preload" href="/styles-9905e2167de1f5db8947.js"/><link as="script" rel="preload" href="/app-b66d6299960035e08442.js"/><link as="script" rel="preload" href="/0-e1610e6154e0a1cad048.js"/><link as="script" rel="preload" href="/1-14606169f663cced6043.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-79b99782120b2491577c.js"/><link as="fetch" rel="preload" href="/static/d/528/path---implementing-react-lazy-ba-4-3e8-BvX0MKx96YVzMT7HVFIU0J0Pli0.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div><style data-emotion-css="3t9ub">*{font-family:-apple-system,blinkmacsystemfont,segoeUI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;margin:0;padding:0;}a:active{opacity:0.7;}.title-anchor{width:20px;height:20px;fill:#3F51B5;}</style><style data-emotion-css="132fjpb">.css-132fjpb{height:60px;background:#fff;}</style><nav class="css-132fjpb edaezx20"><style data-emotion-css="zflk12">.css-zflk12{width:680px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;height:100%;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media only screen and (max-width:768px){.css-zflk12{width:auto;margin-left:1rem;margin-right:1rem;}}</style><div class="css-zflk12 e1koyybp0"><style data-emotion-css="1adwf95">.css-1adwf95{height:40px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;list-style-type:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><ul class="css-1adwf95 edaezx21"><style data-emotion-css="t3tq1o">.css-t3tq1o{padding:0.5rem 1rem;padding-left:0px;}.css-t3tq1o a{-webkit-text-decoration:none;text-decoration:none;color:#3F51B5;}.css-t3tq1o a img{height:24px;vertical-align:middle;border-radius:50%;margin-right:0.5rem;}</style><li class="css-t3tq1o edaezx23"><a href="/">All posts</a></li><style data-emotion-css="1fm72o6">.css-1fm72o6{padding:0.5rem 1rem;}.css-1fm72o6 a{-webkit-text-decoration:none;text-decoration:none;color:#3F51B5;}.css-1fm72o6 a img{height:24px;vertical-align:middle;border-radius:50%;margin-right:0.5rem;}</style><li class="css-1fm72o6 edaezx22"><a href="https://github.com/mfrachet" target="_blank" rel="noreferrer">Github <style data-emotion-css="1ycmoaj">.css-1ycmoaj{color:#373737;}</style><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="css-1ycmoaj edaezx24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></li><li class="css-1fm72o6 edaezx22"><a href="https://twitter.com/mfrachet" target="_blank" rel="noreferrer">Twitter <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="css-1ycmoaj edaezx24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></li></ul></div></nav><style data-emotion-css="rqw1s6">.css-rqw1s6{background:#f4f4f4;margin-bottom:2rem;padding:5rem 0;}@media only screen and (max-width:768px){.css-rqw1s6{height:auto;padding:1rem 0;}}</style><section class="css-rqw1s6 e1m1q1740"><style data-emotion-css="zflk12">.css-zflk12{width:680px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;height:100%;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media only screen and (max-width:768px){.css-zflk12{width:auto;margin-left:1rem;margin-right:1rem;}}</style><div class="css-zflk12 e1koyybp0"><style data-emotion-css="quao9l">.css-quao9l{font-size:2.5em;font-weight:normal;-webkit-letter-spacing:0.07em;-moz-letter-spacing:0.07em;-ms-letter-spacing:0.07em;letter-spacing:0.07em;color:#3F51B5;}</style><h1 class="post-title css-quao9l e1m1q1742">Implementing the React.lazy() function by hand</h1><style data-emotion-css="1rgvko3">.css-1rgvko3{font-size:0.9em;color:#888888;padding:0;margin:0;margin-top:1rem;}</style><p class="css-1rgvko3 e1m1q1741">Published the<!-- --> <!-- -->7/31/2019</p></div></section><style data-emotion-css="qmonuo">.css-qmonuo hr{margin:2rem 0;}.css-qmonuo p,.css-qmonuo li{-webkit-letter-spacing:0.07em;-moz-letter-spacing:0.07em;-ms-letter-spacing:0.07em;letter-spacing:0.07em;font-size:1em;line-height:2em;color:#373737;}.css-qmonuo p{margin-bottom:1.5rem;}.css-qmonuo h1,.css-qmonuo h2,.css-qmonuo h3,.css-qmonuo h4,.css-qmonuo h5,.css-qmonuo h6,.css-qmonuo ul{margin-bottom:1.5rem;list-style:none;}.css-qmonuo li{margin-left:2rem;}.css-qmonuo li::before{font-size:1.6em;vertical-align:middle;content:'• ';color:#3F51B5;}.css-qmonuo h1{font-size:2.5em;font-weight:normal;-webkit-letter-spacing:0.07em;-moz-letter-spacing:0.07em;-ms-letter-spacing:0.07em;letter-spacing:0.07em;}.css-qmonuo h2{font-size:2em;font-weight:normal;-webkit-letter-spacing:0.07em;-moz-letter-spacing:0.07em;-ms-letter-spacing:0.07em;letter-spacing:0.07em;}.css-qmonuo h3{font-size:1.6em;font-weight:normal;-webkit-letter-spacing:0.07em;-moz-letter-spacing:0.07em;-ms-letter-spacing:0.07em;letter-spacing:0.07em;}.css-qmonuo h4{font-size:1.2em;font-weight:normal;-webkit-letter-spacing:0.07em;-moz-letter-spacing:0.07em;-ms-letter-spacing:0.07em;letter-spacing:0.07em;}.css-qmonuo h4.post-title{font-weight:bold;}.css-qmonuo img,.css-qmonuo iframe{border-radius:10px;margin-bottom:2rem;margin-top:2rem;width:100%;}.css-qmonuo pre{margin:2rem 0 3rem 0;border-radius:10px;padding:1.6rem;font-family:inherit;}.css-qmonuo a{color:#3F51B5;font-weight:bold;padding-bottom:0.05em;-webkit-text-decoration:none;text-decoration:none;border-bottom:1px solid #3F51B5;}.css-qmonuo h1 a,.css-qmonuo h2 a,.css-qmonuo h3 a,.css-qmonuo h4 a,.css-qmonuo h5 a{border-bottom:0px;}</style><div class="css-qmonuo"><style data-emotion-css="zflk12">.css-zflk12{width:680px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;height:100%;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media only screen and (max-width:768px){.css-zflk12{width:auto;margin-left:1rem;margin-right:1rem;}}</style><div class="css-zflk12 e1koyybp0"><div><p>It’s been a time since the React’s team has introduced Suspense and concurrent rendering. With hooks, it’s the new amazing feature that React is providing.</p>
<p>We are “able” (at least in dev-mode) to:</p>
<ul>
<li>create applications that manage specific priorities over our asynchronous operations</li>
<li>manage asynchronous computations just like if they were synchronous</li>
<li>use functional components everywhere instead of classes</li>
</ul>
<p>I’m really excited about the future of React!</p>
<hr>
<p>And today, I wanted to talk about a <code class="language-text">Suspense</code> specific feature which is the <code class="language-text">lazy</code> function that was introduced in <a href="https://reactjs.org/blog/2018/10/23/react-v-16-6.html">React v16.6</a>.</p>
<p>This function aims to provide a simple way to rely on bundler’s code splitting using some code like:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> lazy<span class="token punctuation">,</span> Suspense <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">const</span> LazyComponent <span class="token operator">=</span> <span class="token function">lazy</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./components/myComponent'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Suspense</span></span> <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Waiting...</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">LazyComponent</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Suspense</span></span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span></code></pre></div>
<h2 id="what-the"><a href="#what-the" aria-label="what the permalink" class="title-anchor"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M12.971 352h32.394C67.172 454.735 181.944 512 288 512c106.229 0 220.853-57.38 242.635-160h32.394c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0l-67.029 67.029c-7.56 7.56-2.206 20.485 8.485 20.485h35.146c-20.29 54.317-84.963 86.588-144.117 94.015V256h52c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-52v-5.47c37.281-13.178 63.995-48.725 64-90.518C384.005 43.772 341.605.738 289.37.01 235.723-.739 192 42.525 192 96c0 41.798 26.716 77.35 64 90.53V192h-52c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h52v190.015c-58.936-7.399-123.82-39.679-144.117-94.015h35.146c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0L4.485 331.515C-3.074 339.074 2.28 352 12.971 352zM288 64c17.645 0 32 14.355 32 32s-14.355 32-32 32-32-14.355-32-32 14.355-32 32-32z"/><script xmlns=""/></svg></a>What the?..</h2>
<p>It can be a bit disturbing at first, how can we:</p>
<ul>
<li>code split our code, which is a build time feature</li>
<li>make an asychronous computation that creates a component</li>
<li>use an (async?) component in a render function which aims to be synchronous</li>
</ul>
<p>using 2-3 lines?…!</p>
<p><img src="https://media.giphy.com/media/pPhyAv5t9V8djyRFJH/giphy.gif" alt="What the?.."></p>
<h2 id="suspense🤯"><a href="#suspense%F0%9F%A4%AF" aria-label="suspense🤯 permalink" class="title-anchor"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M12.971 352h32.394C67.172 454.735 181.944 512 288 512c106.229 0 220.853-57.38 242.635-160h32.394c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0l-67.029 67.029c-7.56 7.56-2.206 20.485 8.485 20.485h35.146c-20.29 54.317-84.963 86.588-144.117 94.015V256h52c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-52v-5.47c37.281-13.178 63.995-48.725 64-90.518C384.005 43.772 341.605.738 289.37.01 235.723-.739 192 42.525 192 96c0 41.798 26.716 77.35 64 90.53V192h-52c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h52v190.015c-58.936-7.399-123.82-39.679-144.117-94.015h35.146c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0L4.485 331.515C-3.074 339.074 2.28 352 12.971 352zM288 64c17.645 0 32 14.355 32 32s-14.355 32-32 32-32-14.355-32-32 14.355-32 32-32z"/><script xmlns=""/></svg></a>Suspense…🤯</h2>
<p>This is not <em>that</em> magic and can exist thanks to the <code class="language-text">Suspense</code> component.</p>
<p>This component is a bit special and whenever you will <code class="language-text">throw</code> a <code class="language-text">Promise</code> in one of its children, it will <code class="language-text">catch</code> that promise, resolve it and re-render its children.</p>
<p><em>Did you know that you were able to throw something else than errors in JavaScript?!</em></p>
<p>This is why it’s called <code class="language-text">Suspense</code>: it <em>suspends</em> the normal execution flow of your application thanks to the <code class="language-text">throw</code> keyword, and make some specific computations before “resuming” it. It doesn’t resume it at the exact position of your code, but at least, it re-renders its children <strong>which make you feel like you were getting back to the old execution position</strong>.</p>
<p>I tried to write about it in <a href="https://medium.com/free-code-camp/react-cache-time-slicing-and-fetching-with-a-synchronous-api-2a57dc9c2e6d">this Medium post</a> but without success - my thoughts at that period were not that organised.</p>
<p>I won’t keep the “suspense” for now, so let’s check <em>one</em> implementation of the <code class="language-text">lazy</code> function I’ve came across:</p>
<div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>

<span class="token keyword">let</span> <span class="token constant">IDS</span> <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">const</span> loaded <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">lazy</span> <span class="token operator">=</span> <span class="token parameter">modulePathResolver</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token constant">IDS</span><span class="token operator">++</span>

  <span class="token keyword">return</span> <span class="token parameter">props</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> LoadedComponent <span class="token operator">=</span> loaded<span class="token punctuation">[</span>id<span class="token punctuation">]</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>LoadedComponent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token operator">&lt;</span>LoadedComponent <span class="token punctuation">{</span><span class="token operator">...</span>props<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span>
    <span class="token punctuation">}</span>

    <span class="token keyword">throw</span> <span class="token function">modulePathResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">lazyModule</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> Component <span class="token operator">=</span> lazyModule<span class="token punctuation">.</span>default
      loaded<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> Component
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p><strong><a href="https://gist.github.com/mfrachet/a04cc57a500de85170e2ade4b9406305">It’s available on github gist if you want to play with it.</a></strong></p>
<p>Obviously, this snippet only works if the component is used inside a <code class="language-text">Suspense</code> parent.</p>
<p>The <code class="language-text">lazy</code> function accepts one argument <code class="language-text">modulePathResolver</code> which is a <code class="language-text">Promise</code> that resolved the module containing your <em>lazy</em> component.</p>
<p>The <code class="language-text">lazy</code> function returns a function which is in fact a (functional) component. All the references to <code class="language-text">id</code> exist only to make sure that the component has only loaded once.</p>
<p>If you take a closer look at the code, it really looks like a cache system, but instead of setting the cached value directly, it <code class="language-text">throw</code>s a promise that wraps the cache setting so that the Suspense parent can resolve it, <em>lazily</em>.</p>
<p>And you know what? Since it’s an asynchronous operation, it can take some time to execute, milliseconds, seconds or even minutes. And what is displayed <em>during</em> the asynchronous resolution? The <code class="language-text">fallback</code> prop of the <code class="language-text">Suspense</code> component is displayed! Nothing more!</p>
<h2 id="and-now-what"><a href="#and-now-what" aria-label="and now what permalink" class="title-anchor"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M12.971 352h32.394C67.172 454.735 181.944 512 288 512c106.229 0 220.853-57.38 242.635-160h32.394c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0l-67.029 67.029c-7.56 7.56-2.206 20.485 8.485 20.485h35.146c-20.29 54.317-84.963 86.588-144.117 94.015V256h52c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-52v-5.47c37.281-13.178 63.995-48.725 64-90.518C384.005 43.772 341.605.738 289.37.01 235.723-.739 192 42.525 192 96c0 41.798 26.716 77.35 64 90.53V192h-52c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h52v190.015c-58.936-7.399-123.82-39.679-144.117-94.015h35.146c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0L4.485 331.515C-3.074 339.074 2.28 352 12.971 352zM288 64c17.645 0 32 14.355 32 32s-14.355 32-32 32-32-14.355-32-32 14.355-32 32-32z"/><script xmlns=""/></svg></a>And now, what?</h2>
<p>You have an idea of the way the <code class="language-text">lazy</code> function is working but you also now know how <code class="language-text">Suspense</code> is working. You can now imagine every kind of asynchronous resolution without creating <code class="language-text">isLoading</code> states everywhere, every-time. What about lazy image loading with low-high quality pictures 😉?</p>
<p>Jared Palmer is really good advocate of this and has talked about it in multiple talks he has given like the one at <a href="https://www.youtube.com/watch?v=u_0ZMiQZr0k">Chain React 2019</a></p>
<p>My point on this feature is that it also pushes the side effect computations we use to make to the edge of our applications. We can make asynchronous stuff using synchronous APIs without headaches. It makes me think of monads and the capability to isolate and compose what causes (side) effects with trivial code.</p>
<p>Isn’t this pretty cool?!</p>
<p>Happy coding everyone! React has some beautiful days to come! 🚀</p></div></div></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-136744956-2', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"implementing-react-lazy-ba4","path":"/implementing-react-lazy/"};window.dataPath="528/path---implementing-react-lazy-ba-4-3e8-BvX0MKx96YVzMT7HVFIU0J0Pli0";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-b66d6299960035e08442.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-4c010b21325e4fa17523.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-79b99782120b2491577c.js"],"component---src-templates-tags-js":["/component---src-templates-tags-js-533d8b2f1c39a15f4698.js"],"component---src-pages-404-js":["/component---src-pages-404-js-5cc4136e426fec7603ac.js"],"component---src-pages-index-js":["/component---src-pages-index-js-c72cc1efca5d983aef38.js"],"pages-manifest":["/pages-manifest-f055efe8eb0293250f1f.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-79b99782120b2491577c.js" async=""></script><script src="/1-14606169f663cced6043.js" async=""></script><script src="/0-e1610e6154e0a1cad048.js" async=""></script><script src="/app-b66d6299960035e08442.js" async=""></script><script src="/styles-9905e2167de1f5db8947.js" async=""></script><script src="/webpack-runtime-11d36ff36fb5c6e45fb5.js" async=""></script></body></html>