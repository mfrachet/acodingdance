<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.8c4258acfb95297d0e4f.css">code[class*=language-],pre[class*=language-]{text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#90a4ae;background:#fafafa;font-size:1em;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#cceae7;color:#263238}:not(pre)>code[class*=language-]{white-space:normal;border-radius:.2em;padding:.1em}pre[class*=language-]{overflow:auto;position:relative;margin:.5em 0;padding:1.25em 1em}.language-css>code,.language-sass>code,.language-scss>code{color:#f76d47}[class*=language-] .namespace{opacity:.7}.token.atrule{color:#7c4dff}.token.attr-name{color:#39adb5}.token.attr-value,.token.attribute{color:#f6a434}.token.boolean{color:#7c4dff}.token.builtin,.token.cdata,.token.char,.token.class{color:#39adb5}.token.class-name{color:#6182b8}.token.comment{color:#aabfc9}.token.constant{color:#7c4dff}.token.deleted{color:#e53935}.token.doctype{color:#aabfc9}.token.entity{color:#e53935}.token.function{color:#7c4dff}.token.hexcode{color:#f76d47}.token.id,.token.important{color:#7c4dff;font-weight:700}.token.inserted{color:#39adb5}.token.keyword{color:#7c4dff}.token.number{color:#f76d47}.token.operator{color:#39adb5}.token.prolog{color:#aabfc9}.token.property{color:#39adb5}.token.pseudo-class,.token.pseudo-element{color:#f6a434}.token.punctuation{color:#39adb5}.token.regex{color:#6182b8}.token.selector{color:#e53935}.token.string{color:#f6a434}.token.symbol{color:#7c4dff}.token.tag{color:#e53935}.token.unit{color:#f76d47}.token.url,.token.variable{color:#e53935}</style><meta name="generator" content="Gatsby 2.2.10"/><style type="text/css">
    .title-anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .title-anchor svg,
    h2 .title-anchor svg,
    h3 .title-anchor svg,
    h4 .title-anchor svg,
    h5 .title-anchor svg,
    h6 .title-anchor svg {
      visibility: hidden;
    }
    h1:hover .title-anchor svg,
    h2:hover .title-anchor svg,
    h3:hover .title-anchor svg,
    h4:hover .title-anchor svg,
    h5:hover .title-anchor svg,
    h6:hover .title-anchor svg,
    h1 .title-anchor:focus svg,
    h2 .title-anchor:focus svg,
    h3 .title-anchor:focus svg,
    h4 .title-anchor:focus svg,
    h5 .title-anchor:focus svg,
    h6 .title-anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="shortcut icon" href="/icons/icon-48x48.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=8d485ed74983d4ec81528dfc7acbb95a12c9f103"/><title data-react-helmet="true">react-cache: the magic behind the synchronous API | Blog | Marvin Frachet</title><meta data-react-helmet="true" name="description" content="Before starting, I have to mention that the react-cache library is an unstable library but we can create a similar behavior only dealing with React ;) Why to…"/><meta data-react-helmet="true" property="og:title" content="react-cache: the magic behind the synchronous API"/><meta data-react-helmet="true" property="og:description" content="Before starting, I have to mention that the react-cache library is an unstable library but we can create a similar behavior only dealing with React ;) Why to…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Marvin Frachet"/><meta data-react-helmet="true" name="twitter:title" content="react-cache: the magic behind the synchronous API"/><meta data-react-helmet="true" name="twitter:description" content="Before starting, I have to mention that the react-cache library is an unstable library but we can create a similar behavior only dealing with React ;) Why to…"/><link as="script" rel="preload" href="/webpack-runtime-11d36ff36fb5c6e45fb5.js"/><link as="script" rel="preload" href="/styles-9905e2167de1f5db8947.js"/><link as="script" rel="preload" href="/app-b66d6299960035e08442.js"/><link as="script" rel="preload" href="/0-e1610e6154e0a1cad048.js"/><link as="script" rel="preload" href="/1-14606169f663cced6043.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-js-79b99782120b2491577c.js"/><link as="fetch" rel="preload" href="/static/d/660/path---react-cache-the-magic-behind-the-synchronous-api-954-6f1-ixrDoHkcBCFyLc4T1x2NE5CDBQU.json" crossorigin="use-credentials"/></head><body><noscript id="gatsby-noscript">This app works best with JavaScript enabled.</noscript><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div><style data-emotion-css="3t9ub">*{font-family:-apple-system,blinkmacsystemfont,segoeUI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;margin:0;padding:0;}a:active{opacity:0.7;}.title-anchor{width:20px;height:20px;fill:#3F51B5;}</style><style data-emotion-css="132fjpb">.css-132fjpb{height:60px;background:#fff;}</style><nav class="css-132fjpb edaezx20"><style data-emotion-css="zflk12">.css-zflk12{width:680px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;height:100%;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media only screen and (max-width:768px){.css-zflk12{width:auto;margin-left:1rem;margin-right:1rem;}}</style><div class="css-zflk12 e1koyybp0"><style data-emotion-css="1adwf95">.css-1adwf95{height:40px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;list-style-type:none;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><ul class="css-1adwf95 edaezx21"><style data-emotion-css="t3tq1o">.css-t3tq1o{padding:0.5rem 1rem;padding-left:0px;}.css-t3tq1o a{-webkit-text-decoration:none;text-decoration:none;color:#3F51B5;}.css-t3tq1o a img{height:24px;vertical-align:middle;border-radius:50%;margin-right:0.5rem;}</style><li class="css-t3tq1o edaezx23"><a href="/">All posts</a></li><style data-emotion-css="1fm72o6">.css-1fm72o6{padding:0.5rem 1rem;}.css-1fm72o6 a{-webkit-text-decoration:none;text-decoration:none;color:#3F51B5;}.css-1fm72o6 a img{height:24px;vertical-align:middle;border-radius:50%;margin-right:0.5rem;}</style><li class="css-1fm72o6 edaezx22"><a href="https://github.com/mfrachet" target="_blank" rel="noreferrer">Github <style data-emotion-css="1ycmoaj">.css-1ycmoaj{color:#373737;}</style><svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="css-1ycmoaj edaezx24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></li><li class="css-1fm72o6 edaezx22"><a href="https://twitter.com/mfrachet" target="_blank" rel="noreferrer">Twitter <svg stroke="currentColor" fill="none" stroke-width="2" viewBox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" class="css-1ycmoaj edaezx24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg></a></li></ul></div></nav><style data-emotion-css="rqw1s6">.css-rqw1s6{background:#f4f4f4;margin-bottom:2rem;padding:5rem 0;}@media only screen and (max-width:768px){.css-rqw1s6{height:auto;padding:1rem 0;}}</style><section class="css-rqw1s6 e1m1q1740"><style data-emotion-css="zflk12">.css-zflk12{width:680px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;height:100%;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media only screen and (max-width:768px){.css-zflk12{width:auto;margin-left:1rem;margin-right:1rem;}}</style><div class="css-zflk12 e1koyybp0"><style data-emotion-css="quao9l">.css-quao9l{font-size:2.5em;font-weight:normal;-webkit-letter-spacing:0.07em;-moz-letter-spacing:0.07em;-ms-letter-spacing:0.07em;letter-spacing:0.07em;color:#3F51B5;}</style><h1 class="post-title css-quao9l e1m1q1742">react-cache: the magic behind the synchronous API</h1><style data-emotion-css="1rgvko3">.css-1rgvko3{font-size:0.9em;color:#888888;padding:0;margin:0;margin-top:1rem;}</style><p class="css-1rgvko3 e1m1q1741">Published the<!-- --> <!-- -->5/15/2019</p></div></section><style data-emotion-css="qmonuo">.css-qmonuo hr{margin:2rem 0;}.css-qmonuo p,.css-qmonuo li{-webkit-letter-spacing:0.07em;-moz-letter-spacing:0.07em;-ms-letter-spacing:0.07em;letter-spacing:0.07em;font-size:1em;line-height:2em;color:#373737;}.css-qmonuo p{margin-bottom:1.5rem;}.css-qmonuo h1,.css-qmonuo h2,.css-qmonuo h3,.css-qmonuo h4,.css-qmonuo h5,.css-qmonuo h6,.css-qmonuo ul{margin-bottom:1.5rem;list-style:none;}.css-qmonuo li{margin-left:2rem;}.css-qmonuo li::before{font-size:1.6em;vertical-align:middle;content:'• ';color:#3F51B5;}.css-qmonuo h1{font-size:2.5em;font-weight:normal;-webkit-letter-spacing:0.07em;-moz-letter-spacing:0.07em;-ms-letter-spacing:0.07em;letter-spacing:0.07em;}.css-qmonuo h2{font-size:2em;font-weight:normal;-webkit-letter-spacing:0.07em;-moz-letter-spacing:0.07em;-ms-letter-spacing:0.07em;letter-spacing:0.07em;}.css-qmonuo h3{font-size:1.6em;font-weight:normal;-webkit-letter-spacing:0.07em;-moz-letter-spacing:0.07em;-ms-letter-spacing:0.07em;letter-spacing:0.07em;}.css-qmonuo h4{font-size:1.2em;font-weight:normal;-webkit-letter-spacing:0.07em;-moz-letter-spacing:0.07em;-ms-letter-spacing:0.07em;letter-spacing:0.07em;}.css-qmonuo h4.post-title{font-weight:bold;}.css-qmonuo img,.css-qmonuo iframe{border-radius:10px;margin-bottom:2rem;margin-top:2rem;width:100%;}.css-qmonuo pre{margin:2rem 0 3rem 0;border-radius:10px;padding:1.6rem;font-family:inherit;}.css-qmonuo a{color:#3F51B5;font-weight:bold;padding-bottom:0.05em;-webkit-text-decoration:none;text-decoration:none;border-bottom:1px solid #3F51B5;}.css-qmonuo h1 a,.css-qmonuo h2 a,.css-qmonuo h3 a,.css-qmonuo h4 a,.css-qmonuo h5 a{border-bottom:0px;}</style><div class="css-qmonuo"><style data-emotion-css="zflk12">.css-zflk12{width:680px;margin:0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:1;-ms-flex:1;flex:1;height:100%;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}@media only screen and (max-width:768px){.css-zflk12{width:auto;margin-left:1rem;margin-right:1rem;}}</style><div class="css-zflk12 e1koyybp0"><div><p><em>Before starting, I have to mention that the react-cache library is an unstable library but we can create a similar behavior only dealing with React ;)</em></p>
<h2 id="why-to-talk-about-such-a-library"><a href="#why-to-talk-about-such-a-library" aria-label="why to talk about such a library permalink" class="title-anchor"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M12.971 352h32.394C67.172 454.735 181.944 512 288 512c106.229 0 220.853-57.38 242.635-160h32.394c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0l-67.029 67.029c-7.56 7.56-2.206 20.485 8.485 20.485h35.146c-20.29 54.317-84.963 86.588-144.117 94.015V256h52c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-52v-5.47c37.281-13.178 63.995-48.725 64-90.518C384.005 43.772 341.605.738 289.37.01 235.723-.739 192 42.525 192 96c0 41.798 26.716 77.35 64 90.53V192h-52c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h52v190.015c-58.936-7.399-123.82-39.679-144.117-94.015h35.146c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0L4.485 331.515C-3.074 339.074 2.28 352 12.971 352zM288 64c17.645 0 32 14.355 32 32s-14.355 32-32 32-32-14.355-32-32 14.355-32 32-32z"/><script xmlns=""/></svg></a>Why to talk about such a library?</h2>
<p>When <a href="https://twitter.com/dan_abramov">Dan Abramov</a>, at <a href="https://2018.jsconf.is/">JSConf Iceland 2018</a>, has presented this new library <a href="https://www.youtube.com/watch?v=nLF0n9SACd4">coming with Time Slicing and Suspense</a>, it was one of the first time I have absolutely no idea how it may work.</p>
<h2 id="usual-way-to-fetch-data-with-react"><a href="#usual-way-to-fetch-data-with-react" aria-label="usual way to fetch data with react permalink" class="title-anchor"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M12.971 352h32.394C67.172 454.735 181.944 512 288 512c106.229 0 220.853-57.38 242.635-160h32.394c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0l-67.029 67.029c-7.56 7.56-2.206 20.485 8.485 20.485h35.146c-20.29 54.317-84.963 86.588-144.117 94.015V256h52c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-52v-5.47c37.281-13.178 63.995-48.725 64-90.518C384.005 43.772 341.605.738 289.37.01 235.723-.739 192 42.525 192 96c0 41.798 26.716 77.35 64 90.53V192h-52c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h52v190.015c-58.936-7.399-123.82-39.679-144.117-94.015h35.146c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0L4.485 331.515C-3.074 339.074 2.28 352 12.971 352zM288 64c17.645 0 32 14.355 32 32s-14.355 32-32 32-32-14.355-32-32 14.355-32 32-32z"/><script xmlns=""/></svg></a>Usual way to fetch data with React</h2>
<p>In the pre-hooks era, when we wanted to get remote data inside a component only one time, we used to rely on <code class="language-text">componentDidMount</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">class</span> <span class="token class-name">Pokemon</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> pokemonName<span class="token punctuation">:</span> <span class="token keyword">null</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">componentDidMount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">SOME_POKEMON_API_URL</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">pokemon</span> <span class="token operator">=></span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> pokemonName<span class="token punctuation">:</span> pokemon<span class="token punctuation">.</span>name <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>pokemonName <span class="token operator">||</span> <span class="token string">'Fallback :)'</span><span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 id="fetching-data-using-the-react-cache-api"><a href="#fetching-data-using-the-react-cache-api" aria-label="fetching data using the react cache api permalink" class="title-anchor"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M12.971 352h32.394C67.172 454.735 181.944 512 288 512c106.229 0 220.853-57.38 242.635-160h32.394c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0l-67.029 67.029c-7.56 7.56-2.206 20.485 8.485 20.485h35.146c-20.29 54.317-84.963 86.588-144.117 94.015V256h52c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-52v-5.47c37.281-13.178 63.995-48.725 64-90.518C384.005 43.772 341.605.738 289.37.01 235.723-.739 192 42.525 192 96c0 41.798 26.716 77.35 64 90.53V192h-52c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h52v190.015c-58.936-7.399-123.82-39.679-144.117-94.015h35.146c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0L4.485 331.515C-3.074 339.074 2.28 352 12.971 352zM288 64c17.645 0 32 14.355 32 32s-14.355 32-32 32-32-14.355-32-32 14.355-32 32-32z"/><script xmlns=""/></svg></a>Fetching data using the react-cache API</h2>
<p>Now, let’s see how it works using the react-cache library.</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">// importing the library</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> unstable_createResource <span class="token keyword">as</span> createResource <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'react-cache'</span>

<span class="token keyword">const</span> <span class="token constant">POKEMON_API</span> <span class="token operator">=</span> <span class="token string">'https://pokeapi.co/api/v2/pokemon/'</span>

<span class="token keyword">const</span> <span class="token function-variable function">pokemonById</span> <span class="token operator">=</span> <span class="token parameter">id</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">POKEMON_API</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// creating a resource that aims to provide some magic mechanism to the pokemonById function</span>
<span class="token keyword">const</span> ApiResource <span class="token operator">=</span> <span class="token function">createResource</span><span class="token punctuation">(</span>pokemonById<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">Pokemon</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> number <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// really fetching the data, with a synchronous API 😱</span>
  <span class="token keyword">const</span> pokemon <span class="token operator">=</span> ApiResource<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Hello </span><span class="token punctuation">{</span>pokemon<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token comment">// React suspense that will display the fallback content while the request is pending</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Suspense</span></span> <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">Let's wait :D</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Pokemon</span></span> <span class="token attr-name">number</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Suspense</span></span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span></code></pre></div>
<p>Even if this library looks magic at first, it’s forced to rely on a network operation which is something asynchronous. I mean, we don’t have any tool in JavaScript that would allow to fetch something and to block the main thread.</p>
<p>This means that there’s probably a trick behind the scene that I wanted to understand.</p>
<iframe src="https://codesandbox.io/embed/l78vxv7wz9?fontsize=14" style="width:100%; height:500px; border:0; border-radius: 4px; overflow:hidden;" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe>
<h2 id="sum-up-the-information-we-have"><a href="#sum-up-the-information-we-have" aria-label="sum up the information we have permalink" class="title-anchor"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M12.971 352h32.394C67.172 454.735 181.944 512 288 512c106.229 0 220.853-57.38 242.635-160h32.394c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0l-67.029 67.029c-7.56 7.56-2.206 20.485 8.485 20.485h35.146c-20.29 54.317-84.963 86.588-144.117 94.015V256h52c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-52v-5.47c37.281-13.178 63.995-48.725 64-90.518C384.005 43.772 341.605.738 289.37.01 235.723-.739 192 42.525 192 96c0 41.798 26.716 77.35 64 90.53V192h-52c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h52v190.015c-58.936-7.399-123.82-39.679-144.117-94.015h35.146c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0L4.485 331.515C-3.074 339.074 2.28 352 12.971 352zM288 64c17.645 0 32 14.355 32 32s-14.355 32-32 32-32-14.355-32-32 14.355-32 32-32z"/><script xmlns=""/></svg></a>Sum up the information we have</h2>
<p>After reading the previous snippet, we know that:</p>
<ul>
<li>The library aims to fetch Data</li>
<li>It owns a cache in its name so… maybe the data is cached somehow?</li>
<li>It can fetch data in the render function, something that was not possible</li>
<li>It relies on a synchronous API</li>
</ul>
<p>Let’s put some <code class="language-text">console.log</code> in our component to check how it behaves:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">const</span> <span class="token function-variable function">Pokemon</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> number <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"I'm passing here two times 🤔"</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> pokemon <span class="token operator">=</span> ApiResource<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"I'm passing here only ONE time 😦"</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>pokemon<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span></code></pre></div>
<p>The result is clear: the first log is printed two times while the second one is run only once. I can now take two other information from there:</p>
<ul>
<li>The <code class="language-text">Pokemon</code> (render) function is executed twice</li>
<li><code class="language-text">ApiRessource.read</code> breaks the normal program flow, this is why the second log is reached only once</li>
</ul>
<p>Let’s try to see how we can implement such a system.</p>
<h2 id="lets-code"><a href="#lets-code" aria-label="lets code permalink" class="title-anchor"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M12.971 352h32.394C67.172 454.735 181.944 512 288 512c106.229 0 220.853-57.38 242.635-160h32.394c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0l-67.029 67.029c-7.56 7.56-2.206 20.485 8.485 20.485h35.146c-20.29 54.317-84.963 86.588-144.117 94.015V256h52c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-52v-5.47c37.281-13.178 63.995-48.725 64-90.518C384.005 43.772 341.605.738 289.37.01 235.723-.739 192 42.525 192 96c0 41.798 26.716 77.35 64 90.53V192h-52c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h52v190.015c-58.936-7.399-123.82-39.679-144.117-94.015h35.146c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0L4.485 331.515C-3.074 339.074 2.28 352 12.971 352zM288 64c17.645 0 32 14.355 32 32s-14.355 32-32 32-32-14.355-32-32 14.355-32 32-32z"/><script xmlns=""/></svg></a>Let’s code!</h2>
<h3 id="initializing-a-new-project"><a href="#initializing-a-new-project" aria-label="initializing a new project permalink" class="title-anchor"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M12.971 352h32.394C67.172 454.735 181.944 512 288 512c106.229 0 220.853-57.38 242.635-160h32.394c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0l-67.029 67.029c-7.56 7.56-2.206 20.485 8.485 20.485h35.146c-20.29 54.317-84.963 86.588-144.117 94.015V256h52c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-52v-5.47c37.281-13.178 63.995-48.725 64-90.518C384.005 43.772 341.605.738 289.37.01 235.723-.739 192 42.525 192 96c0 41.798 26.716 77.35 64 90.53V192h-52c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h52v190.015c-58.936-7.399-123.82-39.679-144.117-94.015h35.146c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0L4.485 331.515C-3.074 339.074 2.28 352 12.971 352zM288 64c17.645 0 32 14.355 32 32s-14.355 32-32 32-32-14.355-32-32 14.355-32 32-32z"/><script xmlns=""/></svg></a>Initializing a new project</h3>
<p>I suggest you create a simple project using <a href="https://github.com/facebook/create-react-app"><code class="language-text">create-react-app</code></a>:</p>
<div class="gatsby-highlight" data-language="shell"><pre class="language-shell"><code class="language-shell">$ npm i -g create-react-app
$ create-react-app my-synchronous-fetchapp
$ cd my-synchronous-fetchapp</code></pre></div>
<hr>
<p>Now, let’s modify our <code class="language-text">App.js</code> file so that it looks like:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token comment">// We re going to implement that module 😎</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  unstable_createResource <span class="token keyword">as</span> createResource<span class="token punctuation">,</span>
  Suspense<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./react-cache'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Loader <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./components/Loader'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> PokemonDetail <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./components/PokemonDetail'</span>
<span class="token keyword">const</span> <span class="token constant">POKEMON_API</span> <span class="token operator">=</span> <span class="token string">'https://pokeapi.co/api/v2/pokemon/'</span>

<span class="token comment">/* Application */</span>
<span class="token keyword">const</span> <span class="token function-variable function">pokemonById</span> <span class="token operator">=</span> <span class="token parameter">id</span> <span class="token operator">=></span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">POKEMON_API</span> <span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=></span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> ApiResource <span class="token operator">=</span> <span class="token function">createResource</span><span class="token punctuation">(</span>pokemonById<span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">Pokemon</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> number <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> pokemon <span class="token operator">=</span> ApiResource<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span><span class="token punctuation">{</span>pokemon<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Suspense</span></span> <span class="token attr-name">fallback</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Loader</span></span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Waiting for the pokemons<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token punctuation">}</span></span><span class="token punctuation">></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Pokemon</span></span> <span class="token attr-name">number</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token number">6</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Suspense</span></span><span class="token punctuation">></span></span>
<span class="token punctuation">)</span></code></pre></div>
<p>As you’ve probably mentioned, we’re trying to import <code class="language-text">./react-cache</code> which is something that doesn’t exist.</p>
<h3 id="creating-our-custom-react-cache"><a href="#creating-our-custom-react-cache" aria-label="creating our custom react cache permalink" class="title-anchor"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M12.971 352h32.394C67.172 454.735 181.944 512 288 512c106.229 0 220.853-57.38 242.635-160h32.394c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0l-67.029 67.029c-7.56 7.56-2.206 20.485 8.485 20.485h35.146c-20.29 54.317-84.963 86.588-144.117 94.015V256h52c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-52v-5.47c37.281-13.178 63.995-48.725 64-90.518C384.005 43.772 341.605.738 289.37.01 235.723-.739 192 42.525 192 96c0 41.798 26.716 77.35 64 90.53V192h-52c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h52v190.015c-58.936-7.399-123.82-39.679-144.117-94.015h35.146c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0L4.485 331.515C-3.074 339.074 2.28 352 12.971 352zM288 64c17.645 0 32 14.355 32 32s-14.355 32-32 32-32-14.355-32-32 14.355-32 32-32z"/><script xmlns=""/></svg></a>Creating our custom react-cache</h3>
<p>Let’s now create the not existing <code class="language-text">./src/react-cache</code> folder with an <code class="language-text">index.js</code> inside. According to the thing we’ve previously used in the example snippets, we can imagine the following module definition in <code class="language-text">index.js</code>:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token comment">/**
 * The usage is:
 * const ApiResource = createResource(fetchFunction)
 * ApiResource.read()
 * We supposed it also exist a ApiResource.write()
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">unstable_createResource</span> <span class="token operator">=</span> <span class="token parameter">somethingThatFetches</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ApiResource <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// Read some data somewhere using some arguments</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> ApiResource
<span class="token punctuation">}</span>

<span class="token comment">/**
 * React Suspense equivalent
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Suspense</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<p><em>For the purpose of the post, I voluntary redefined Suspense inside this library. In reality, Suspense is part of React, not react-cache</em>.</p>
<h3 id="implementing-the-cache-system"><a href="#implementing-the-cache-system" aria-label="implementing the cache system permalink" class="title-anchor"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M12.971 352h32.394C67.172 454.735 181.944 512 288 512c106.229 0 220.853-57.38 242.635-160h32.394c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0l-67.029 67.029c-7.56 7.56-2.206 20.485 8.485 20.485h35.146c-20.29 54.317-84.963 86.588-144.117 94.015V256h52c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-52v-5.47c37.281-13.178 63.995-48.725 64-90.518C384.005 43.772 341.605.738 289.37.01 235.723-.739 192 42.525 192 96c0 41.798 26.716 77.35 64 90.53V192h-52c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h52v190.015c-58.936-7.399-123.82-39.679-144.117-94.015h35.146c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0L4.485 331.515C-3.074 339.074 2.28 352 12.971 352zM288 64c17.645 0 32 14.355 32 32s-14.355 32-32 32-32-14.355-32-32 14.355-32 32-32z"/><script xmlns=""/></svg></a>Implementing the cache system</h3>
<p>Well, react-cache is a library that probably relies on a cache. I think that we should use the least most code to create the simplest possible cache system:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token comment">/**
 * The usage is:
 * const ApiResource = createResource(fetchFunction)
 * ApiResource.read()
 * We supposed it also exist a ApiResource.write()
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">unstable_createResource</span> <span class="token operator">=</span> <span class="token parameter">somethingThatFetches</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// The cache itself</span>
  <span class="token keyword">let</span> cache

  <span class="token keyword">const</span> ApiResource <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// Read some data somewhere using some arguments</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// fill the cache with something</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> cache
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> ApiResource
<span class="token punctuation">}</span>

<span class="token comment">/**
 * React Suspense equivalent
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Suspense</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre></div>
<h2 id="the-tricky-part"><a href="#the-tricky-part" aria-label="the tricky part permalink" class="title-anchor"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M12.971 352h32.394C67.172 454.735 181.944 512 288 512c106.229 0 220.853-57.38 242.635-160h32.394c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0l-67.029 67.029c-7.56 7.56-2.206 20.485 8.485 20.485h35.146c-20.29 54.317-84.963 86.588-144.117 94.015V256h52c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-52v-5.47c37.281-13.178 63.995-48.725 64-90.518C384.005 43.772 341.605.738 289.37.01 235.723-.739 192 42.525 192 96c0 41.798 26.716 77.35 64 90.53V192h-52c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h52v190.015c-58.936-7.399-123.82-39.679-144.117-94.015h35.146c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0L4.485 331.515C-3.074 339.074 2.28 352 12.971 352zM288 64c17.645 0 32 14.355 32 32s-14.355 32-32 32-32-14.355-32-32 14.355-32 32-32z"/><script xmlns=""/></svg></a>The tricky part</h2>
<p>It’s now time to deal with the “tricky” part. Do you remember that react-cache library interrupts the current component rendering?
I know one way to make that interruptions: throwing an error. And this is the way react-cache handles this.</p>
<p>Let’s imagine that:</p>
<ul>
<li><code class="language-text">ApiResource.read</code> will try to read its internal cache</li>
<li>If it exists, it returns the value of the cache</li>
<li>If not, it throws a <code class="language-text">Promise</code> that the parent can resolve</li>
<li>The parent will re-render and resolve the <code class="language-text">Promise</code> that <strong>modifies the cached value</strong></li>
</ul>
<p>In our scenario:</p>
<ul>
<li>Calling <code class="language-text">ApiResource.read</code> will interrupt the <code class="language-text">Pokemon</code> render function by throwing a <code class="language-text">Promise</code></li>
<li>Our own definition of <code class="language-text">Suspense</code> will catch that <code class="language-text">Promise</code>, make the HTTP call and set the cache value</li>
<li>The <code class="language-text">Suspense</code> parent will now be able to re-render its <code class="language-text">Pokemon</code> children with the cached data</li>
</ul>
<h3 id="handling-te-scenario"><a href="#handling-te-scenario" aria-label="handling te scenario permalink" class="title-anchor"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M12.971 352h32.394C67.172 454.735 181.944 512 288 512c106.229 0 220.853-57.38 242.635-160h32.394c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0l-67.029 67.029c-7.56 7.56-2.206 20.485 8.485 20.485h35.146c-20.29 54.317-84.963 86.588-144.117 94.015V256h52c6.627 0 12-5.373 12-12v-40c0-6.627-5.373-12-12-12h-52v-5.47c37.281-13.178 63.995-48.725 64-90.518C384.005 43.772 341.605.738 289.37.01 235.723-.739 192 42.525 192 96c0 41.798 26.716 77.35 64 90.53V192h-52c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h52v190.015c-58.936-7.399-123.82-39.679-144.117-94.015h35.146c10.691 0 16.045-12.926 8.485-20.485l-67.029-67.029c-4.686-4.686-12.284-4.686-16.971 0L4.485 331.515C-3.074 339.074 2.28 352 12.971 352zM288 64c17.645 0 32 14.355 32 32s-14.355 32-32 32-32-14.355-32-32 14.355-32 32-32z"/><script xmlns=""/></svg></a>Handling te scenario:</h3>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'react'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">unstable_createResource</span> <span class="token operator">=</span> <span class="token parameter">somethingThatFetches</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> cache

  <span class="token keyword">const</span> ApiResource <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">/**
         * Throws the promise that modifies the cached data
         */</span>
        <span class="token keyword">const</span> toResolve <span class="token operator">=</span> <span class="token punctuation">{</span>
          toResolve<span class="token punctuation">:</span> <span class="token function">somethingThatFetches</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
            cache <span class="token operator">=</span> data
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">throw</span> toResolve
      <span class="token punctuation">}</span>

      <span class="token keyword">return</span> cache
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> ApiResource
<span class="token punctuation">}</span></code></pre></div>
<p>The <code class="language-text">Suspense</code> parent is now able to deal with this error:</p>
<div class="gatsby-highlight" data-language="jsx"><pre class="language-jsx"><code class="language-jsx"><span class="token comment">/**
 * React Suspense equivalent
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Suspense</span> <span class="token keyword">extends</span> <span class="token class-name">React<span class="token punctuation">.</span>Component</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">props</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span>

    <span class="token comment">// Creates a simply state verifying that we have an error or not</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token punctuation">{</span> hasError<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// When we get an error, let's ajust the state in consequence</span>
  <span class="token keyword">static</span> <span class="token function">getDerivedStateFromError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span> hasError<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// componentDidCatch parameter is an error olding a promise to resolve that will modify the cached value 🤯</span>
  <span class="token keyword">async</span> <span class="token function">componentDidCatch</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> error<span class="token punctuation">.</span>toResolve

    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hasError<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> children<span class="token punctuation">,</span> fallback <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>props

    <span class="token comment">// Render the fallback when there is a pending error,</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">.</span>hasError <span class="token operator">?</span> fallback <span class="token punctuation">:</span> children
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>🎉🎉🎉 If you run the code, it should be working and fetches remote data using a synchronous API 😎</p>
<hr>
<p>For a full example, check the <a href="https://mfrachet.github.io/react-cache-meetup/">https://mfrachet.github.io/react-cache-meetup/</a> application!</p></div></div></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-136744956-2', 'auto', {});
      
      
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-blog-post-js","jsonName":"react-cache-the-magic-behind-the-synchronous-api-954","path":"/react-cache-the-magic-behind-the-synchronous-api/"};window.dataPath="660/path---react-cache-the-magic-behind-the-synchronous-api-954-6f1-ixrDoHkcBCFyLc4T1x2NE5CDBQU";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-b66d6299960035e08442.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-4c010b21325e4fa17523.js"],"component---src-templates-blog-post-js":["/component---src-templates-blog-post-js-79b99782120b2491577c.js"],"component---src-templates-tags-js":["/component---src-templates-tags-js-533d8b2f1c39a15f4698.js"],"component---src-pages-404-js":["/component---src-pages-404-js-5cc4136e426fec7603ac.js"],"component---src-pages-index-js":["/component---src-pages-index-js-c72cc1efca5d983aef38.js"],"pages-manifest":["/pages-manifest-f055efe8eb0293250f1f.js"]};/*]]>*/</script><script src="/component---src-templates-blog-post-js-79b99782120b2491577c.js" async=""></script><script src="/1-14606169f663cced6043.js" async=""></script><script src="/0-e1610e6154e0a1cad048.js" async=""></script><script src="/app-b66d6299960035e08442.js" async=""></script><script src="/styles-9905e2167de1f5db8947.js" async=""></script><script src="/webpack-runtime-11d36ff36fb5c6e45fb5.js" async=""></script></body></html>